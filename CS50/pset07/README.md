Лучше не смотреть этот код :)
Он всё ещё дорабатывается.
